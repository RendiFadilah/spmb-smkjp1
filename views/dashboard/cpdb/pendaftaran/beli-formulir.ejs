<% if (!user.formulir) { %>
<div class="max-w-7xl mx-auto py-8">
    <!-- Icon and Title -->
    <div class="text-center mb-8">
        <h3 class="text-2xl font-bold text-gray-800 mb-3">Beli Formulir Pendaftaran</h3>
        <div class="h-1 w-20 bg-gradient-to-r from-green-400 to-green-600 mx-auto rounded-full mb-4"></div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column: Information Card -->
        <div class="bg-gradient-to-br from-white to-gray-50 rounded-2xl p-8 shadow-xl border border-gray-100 hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
            <h4 class="text-xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-info-circle text-green-500 mr-3"></i>
                Informasi Pembelian Formulir
            </h4>
            <div class="space-y-6 text-gray-600">
                <p class="flex items-center">
                    <i class="fas fa-tag text-green-500 mr-3"></i>
                    Biaya formulir: <span class="font-semibold ml-2">Rp 150,000</span>
                </p>
                <p class="flex items-center">
                    <i class="fas fa-university text-green-500 mr-3"></i>
                    Pembayaran melalui transfer ke:
                </p>
                <div class="p-6 bg-gradient-to-br from-white to-gray-50 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group hover:shadow-md transition-all duration-300">
                    <!-- Background Pattern -->
                    <div class="absolute top-0 right-0 w-32 h-32 opacity-5 transform translate-x-16 -translate-y-8">
                        <i class="fas fa-university text-6xl"></i>
                    </div>
                    <!-- Bank Logo -->
                    <div class="absolute top-4 right-4 w-10 h-10 bg-green-500 bg-opacity-10 rounded-full flex items-center justify-center">
                        <i class="fas fa-university text-green-600"></i>
                    </div>
                    <!-- Content -->
                    <div class="relative">
                        <p class="text-sm text-gray-500 mb-1">Bank Syariah Indonesia</p>
                        <p class="font-medium text-gray-800 mb-3">SMK Jakarta Pusat 1</p>
                        <div class="flex items-center space-x-2">
                            <p class="font-mono text-xl font-semibold text-gray-800 tracking-wider">777222222</p>
                            <button onclick="copyToClipboard('777222222')" class="text-green-600 hover:text-green-700 focus:outline-none" title="Salin Nomor Rekening">
                                <i class="far fa-copy"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Decorative Elements -->
                    <div class="absolute bottom-0 right-0 w-full h-1 bg-gradient-to-r from-green-400 to-green-600 opacity-50 transform translate-y-0.5"></div>
                </div>

                <div class="mt-4 p-4 bg-yellow-50 rounded-lg border border-yellow-100">
                    <div class="space-y-3">
                        <p class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-500 mr-3 mt-1"></i>
                            <span>Untuk mendapatkan kode pembayaran, silakan hubungi tim kami melalui WhatsApp dengan menyertakan bukti transfer.</span>
                        </p>
                        <div class="pl-7">
                            <p class="text-sm text-gray-600">Langkah-langkah:</p>
                            <ol class="list-decimal pl-5 text-sm text-gray-600 space-y-1 mt-1">
                                <li>Transfer biaya formulir ke rekening di atas</li>
                                <li>Klik tombol "Hubungi via WhatsApp" di bawah</li>
                                <li>Kirim bukti transfer ke WhatsApp</li>
                                <li>Tim kami akan memberikan kode pembayaran</li>
                                <li>Masukkan kode pembayaran di form website</li>
                            </ol>
                        </div>
                        <p class="flex items-start text-sm text-gray-600 pl-7">
                            <i class="fas fa-clock text-yellow-500 mr-2"></i>
                            <span>Tim kami siap melayani 24 jam</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Contact and Action -->
        <div class="space-y-6">
            <!-- WhatsApp Contact Card -->
            <div class="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 rounded-2xl p-8 border border-green-100 shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 relative overflow-hidden">
                <!-- Decorative Background Pattern -->
                <div class="absolute top-0 right-0 w-64 h-64 opacity-5">
                    <i class="fab fa-whatsapp text-8xl transform rotate-12"></i>
                </div>
                
                <div class="flex items-start space-x-6 relative">
                    <div class="flex-grow">
                        <h5 class="text-xl font-bold text-gray-800 mb-3">Hubungi Tim PPDB</h5>
                        <p class="text-gray-600 mb-4 leading-relaxed">Silakan hubungi tim kami melalui WhatsApp untuk bantuan dan informasi lebih lanjut. Kami siap membantu Anda 24/7.</p>
                        <div class="flex items-center space-x-3 text-green-600 bg-green-50 px-4 py-2 rounded-xl inline-flex">
                            <a href="https://wa.me/6283894545418?text=Hallo%20bapak%2Fibu%20tim%20SPMB%20SMK%20Jakarta%20Timur%201%202025.%20Saya%20ingin%20membeli%20formulir%20pendaftaran%20murid%20baru%20di%20SMK%20Jakarta%20Timur%201" 
                               target="_blank" 
                               class="group relative px-8 py-4 bg-gradient-to-br from-green-400 via-green-500 to-green-600 text-white rounded-2xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 shadow-xl overflow-hidden flex-1 flex items-center justify-center space-x-3">
                                <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                <div class="flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm">
                                    <i class="fab fa-whatsapp text-3xl"></i>
                                </div>
                                <span class="font-bold text-lg tracking-wide">Hubungi via WhatsApp</span>
                                <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-white/0 via-white/40 to-white/0 transform translate-y-1"></div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col gap-4">
                <button onclick="openPaymentModal()" 
                        class="group relative px-8 py-4 bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-2xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-xl overflow-hidden flex-1 flex items-center justify-center space-x-3">
                    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    <div class="flex items-center justify-center w-12 h-12 bg-white/20 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-credit-card text-3xl"></i>
                    </div>
                    <span class="font-bold text-lg tracking-wide">Bayar Sekarang</span>
                    <div class="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-white/0 via-white/40 to-white/0 transform translate-y-1"></div>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="fixed inset-0 z-50 hidden overflow-y-auto">
    <div class="flex items-center justify-center min-h-screen px-4">
        <!-- Overlay -->
        <div class="fixed inset-0 bg-black opacity-50"></div>
        
        <!-- Modal Content -->
        <div class="relative bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform transition-all">
            <div class="absolute top-4 right-4">
                <button onclick="closePaymentModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-file-invoice-dollar text-2xl text-blue-600"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900">Pembelian Formulir</h3>
                <p class="text-sm text-gray-600 mt-1">Silakan lengkapi data pembayaran</p>
            </div>

            <form id="paymentForm" onsubmit="submitPayment(event)" class="space-y-6" enctype="multipart/form-data">
                <input type="hidden" name="nominal_formulir" value="150000">
                <input type="hidden" name="id_kode_pembayaran">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Nominal
                    </label>
                    <div class="relative rounded-lg border border-gray-300 bg-gray-50 px-4 py-3">
                        <span class="text-gray-900 font-medium">Rp 150,000</span>
                    </div>
                </div>

                <div>
                    <label for="kode_bayar" class="block text-sm font-medium text-gray-700 mb-2">
                        Kode Pembayaran
                    </label>
                    <input type="text" 
                           id="kode_bayar" 
                           name="kode_bayar" 
                           required
                           placeholder="Masukkan kode pembayaran"
                           class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-3 focus:border-blue-500 focus:ring-blue-500 placeholder-gray-400"
                    >
                </div>

                <div>
                    <label for="bukti_bayar" class="block text-sm font-medium text-gray-700 mb-2">
                        Bukti Pembayaran (Opsional)
                    </label>
                    <input type="file" id="bukti_bayar" name="bukti_bayar" accept="image/*"
                           class="block w-full rounded-lg border border-gray-300 bg-white px-4 py-3 focus:border-blue-500 focus:ring-blue-500">
                    <p class="mt-1 text-xs text-gray-500">Format: JPG, JPEG, PNG (Max. 5MB)</p>
                </div>

                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" onclick="closePaymentModal()"
                            class="px-6 py-3 text-sm font-semibold text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                        Batal
                    </button>
                    <button type="submit"
                            class="relative px-6 py-3 text-sm font-semibold text-white bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 rounded-xl hover:opacity-95 transition-all duration-300 transform hover:-translate-y-0.5 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-lg overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <span>Simpan</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<% } else { %>
<!-- Content for users who have purchased the form -->
<div class="max-w-7xl mx-auto py-8">
    <div class="bg-white rounded-2xl shadow-xl p-8 border border-green-100">
        <div class="text-center">
            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fas fa-check-circle text-4xl text-green-500"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Terima Kasih!</h3>
            <p class="text-gray-600 mb-6">
                Anda telah berhasil membeli formulir pendaftaran.
            </p>

            <% if (user.formulir.status === 'Proses' || !user.formulir.status) { %>
            <!-- Status: Proses -->
            <div class="p-6 bg-yellow-50 rounded-lg border border-yellow-100 text-left max-w-2xl mx-auto">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 mt-1">
                        <i class="fas fa-info-circle text-2xl text-yellow-500"></i>
                    </div>
                    <div class="flex-grow">
                        <h4 class="text-lg font-semibold text-gray-800 mb-2">Status Verifikasi Pembayaran</h4>
                        <p class="text-yellow-700">
                            Mohon menunggu, tim kami sedang memverifikasi pembayaran Anda. 
                            Proses ini biasanya memakan waktu 1x24 jam kerja.
                        </p>
                        <div class="mt-4 p-4 bg-white rounded-lg border border-yellow-200">
                            <p class="text-sm text-gray-600">
                                Jika pembayaran telah diverifikasi, Anda akan dapat melanjutkan ke tahap pengisian formulir.
                                Silakan periksa halaman ini secara berkala.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <% } else if (user.formulir.status === 'Terverifikasi') { %>
            <!-- Status: Terverifikasi -->
            <div class="space-y-8">
                <!-- Payment Success Card -->
                <div class="p-8 bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl border border-green-100 text-left max-w-4xl mx-auto relative overflow-hidden">
                    <!-- Decorative Background Pattern -->
                    <div class="absolute top-0 right-0 w-64 h-64 opacity-5">
                        <i class="fas fa-check-circle text-8xl transform rotate-12"></i>
                    </div>
                    
                    <div class="relative">
                        <!-- Header -->
                        <div class="flex items-center space-x-4 mb-6">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-check-circle text-2xl text-green-500"></i>
                            </div>
                            <div>
                                <h4 class="text-xl font-bold text-gray-800">Pembayaran Terverifikasi</h4>
                                <p class="text-green-600 text-sm">Pembayaran formulir Anda telah berhasil diverifikasi</p>
                            </div>
                        </div>

                        <!-- Payment Details -->
                        <div class="bg-white rounded-xl p-6 shadow-sm border border-green-100 space-y-4 mb-6">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">Nomor Formulir</p>
                                    <p class="font-semibold text-gray-800"><%= user.formulir.no_formulir %></p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Tanggal dan Waktu Verifikasi</p>
                                    <p class="font-semibold text-gray-800">
                                        <%= new Date(user.formulir.updated_at).toLocaleString('id-ID', { 
                                            day: 'numeric', 
                                            month: 'long', 
                                            year: 'numeric',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        }) %> WIB
                                    </p>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500">Nominal</p>
                                    <p class="font-semibold text-gray-800">
                                        Rp <%= Number(user.formulir.nominal_formulir).toLocaleString('id-ID', {
                                            minimumFractionDigits: 0,
                                            maximumFractionDigits: 0
                                        }) %>
                                    </p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">Status</p>
                                    <div class="flex items-center space-x-2">
                                        <span class="inline-flex items-center mt-2 px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-check-circle mr-1"></i>
                                            Terverifikasi
                                        </span>
                                        <span class="text-sm text-gray-600 mt-2">
                                            oleh <span class="font-medium text-gray-800"><%= user.formulir.verifikator %></span>
                                        </span>
                                    </div>
                                </div>
                             
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4 justify-center">
                            <!-- Download Receipt Button -->
                            <!-- <a href="/dashboard/cpdb/pendaftaran/kuitansi/<%= user.formulir.id_formulir %>" 
                               target="_blank"
                               class="group relative px-6 py-3 bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 text-white rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 shadow-lg overflow-hidden inline-flex items-center justify-center">
                                <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                <i class="fas fa-download mr-2"></i>
                                <span class="font-semibold">Download Kuitansi</span>
                            </a> -->

                            <!-- Continue to Form Button -->
                            <a href="/dashboard/cpdb/pendaftaran/isi-formulir" 
                               class="group relative px-6 py-3 bg-gradient-to-br from-green-500 via-green-600 to-emerald-700 text-white rounded-xl hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 shadow-lg overflow-hidden inline-flex items-center justify-center">
                                <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-white/20 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                <i class="fas fa-edit mr-2"></i>
                                <span class="font-semibold">Isi Formulir Sekarang</span>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="bg-blue-50 rounded-xl p-6 border border-blue-100 max-w-4xl mx-auto">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle text-2xl text-blue-500"></i>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-2">Langkah Selanjutnya</h5>
                            <p class="text-gray-600 text-sm mb-4">
                                Silakan lanjutkan ke tahap pengisian formulir dengan mengklik tombol "Isi Formulir Sekarang" di atas. 
                                Pastikan untuk menyiapkan dokumen-dokumen berikut:
                            </p>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex items-center">
                                    <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                    FC Ijazah Negeri / Swasta yang sudah Legalisir
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                    FC Nomor Induk Siswa Nasional
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                    FC Raport Semester Ganjil dan Genap SMP/MTs Kelas Terakhir
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                    FC Akte Kelahiran
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                    FC Kartu Keluarga (KK)
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <% } %>

        </div>
    </div>
</div>
<% } %>

<!-- Toast Container -->
<div id="toast-container" class="fixed top-4 right-4 z-50"></div>

<script>
// Toast notification system
function showToast(message, type = 'success') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    
    const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
    const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
    
    toast.className = `${bgColor} text-white px-6 py-4 rounded-lg shadow-lg flex items-center space-x-3 mb-4 transform translate-x-full transition-transform duration-300`;
    toast.innerHTML = `
        <i class="fas ${icon}"></i>
        <span>${message}</span>
    `;
    
    container.appendChild(toast);
    
    // Animate in
    setTimeout(() => {
        toast.classList.remove('translate-x-full');
    }, 100);
    
    // Remove after 5 seconds
    setTimeout(() => {
        toast.classList.add('translate-x-full');
        setTimeout(() => {
            container.removeChild(toast);
        }, 300);
    }, 5000);
}

// Clipboard functionality
window.copyToClipboard = function(text) {
    var tempInput = document.createElement('input');
    tempInput.value = text;
    document.body.appendChild(tempInput);
    
    try {
        tempInput.select();
        document.execCommand('copy');
        showToast('Nomor rekening berhasil disalin!', 'success');
    } catch (err) {
        showToast('Gagal menyalin nomor rekening', 'error');
    } finally {
        document.body.removeChild(tempInput);
    }
};

function openPaymentModal() {
    document.getElementById('paymentModal').classList.remove('hidden');
}

function closePaymentModal() {
    document.getElementById('paymentModal').classList.add('hidden');
    document.getElementById('paymentForm').reset();
}

let isSubmitting = false;

function submitPayment(event) {
    event.preventDefault();
    
    // Prevent double submission
    if (isSubmitting) {
        return;
    }
    
    var submitBtn = event.target.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    isSubmitting = true;
    
    var formData = new FormData(event.target);
    var kodeBayar = formData.get('kode_bayar');
    
    if (!kodeBayar) {
        showToast('Kode pembayaran harus diisi', 'error');
        submitBtn.disabled = false;
        isSubmitting = false;
        return;
    }

    var checkUrl = '/api/cpdb/formulir/kode-pembayaran/check/' + kodeBayar;
    
    var xhr = new XMLHttpRequest();
    xhr.open('GET', checkUrl, true);
    
    xhr.onload = function() {
        if (xhr.status === 200) {
            var response = JSON.parse(xhr.responseText);
            
            var newFormData = new FormData();
            newFormData.append('id_kode_pembayaran', response.id_kode_pembayaran);
            newFormData.append('nominal_formulir', formData.get('nominal_formulir'));
            
            if (formData.get('bukti_bayar')) {
                newFormData.append('bukti_bayar', formData.get('bukti_bayar'));
            }
            
            var submitXhr = new XMLHttpRequest();
            submitXhr.open('POST', '/api/cpdb/formulir', true);
            
            submitXhr.onload = function() {
                try {
                    var submitResponse = JSON.parse(submitXhr.responseText);
                    if (submitXhr.status === 201 && submitResponse.id_formulir) {
                        showToast('Pembelian formulir berhasil!', 'success');
                        setTimeout(() => {
                            closePaymentModal();
                            window.location.reload();
                        }, 2000);
                    } else if (submitXhr.status === 400) {
                        showToast(submitResponse.message, 'error');
                        submitBtn.disabled = false;
                        isSubmitting = false;
                        if (submitResponse.message === 'Anda sudah memiliki formulir pendaftaran') {
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        }
                    } else {
                        showToast(submitResponse.message || 'Terjadi kesalahan saat memproses formulir', 'error');
                        submitBtn.disabled = false;
                        isSubmitting = false;
                    }
                } catch (error) {
                    showToast('Terjadi kesalahan saat memproses formulir', 'error');
                    submitBtn.disabled = false;
                    isSubmitting = false;
                }
            };
            
            submitXhr.onerror = function() {
                showToast('Terjadi kesalahan saat menghubungi server', 'error');
                submitBtn.disabled = false;
                isSubmitting = false;
            };
            
            submitXhr.send(newFormData);
        } else if (xhr.status === 401) {
            showToast('Sesi anda telah berakhir, silakan login kembali', 'error');
            setTimeout(() => {
                window.location.href = '/auth';
            }, 2000);
        } else {
            showToast('Kode pembayaran tidak valid atau sudah digunakan', 'error');
            submitBtn.disabled = false;
            isSubmitting = false;
        }
    };
    
    xhr.onerror = function() {
        showToast('Terjadi kesalahan saat menghubungi server', 'error');
        submitBtn.disabled = false;
        isSubmitting = false;
    };
    
    xhr.send();
}

// Reset submission flag when modal is closed
function closePaymentModal() {
    document.getElementById('paymentModal').classList.add('hidden');
    document.getElementById('paymentForm').reset();
    isSubmitting = false;
}
</script>
