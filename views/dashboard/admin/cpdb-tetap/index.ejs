<!-- Page Title with gradient background -->
<div class="mb-8 bg-white p-6 rounded-xl border border-green-100">
    <h1 class="text-3xl font-bold text-gray-800">Data CPDB Tetap</h1>
    <p class="mt-2 text-gray-600">Kelola data calon peserta didik baru yang sudah terverifikasi</p>
</div>

<!-- Nav Tabs -->
<div class="mb-6">
    <div class="border-b border-gray-200">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
            <button onclick="switchTab('all')" 
                    class="tab-button border-green-500 text-green-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-all">
                Keseluruhan
            </button>
            <button onclick="switchTab('AK')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-AK">
                Akuntansi
            </button>
            <button onclick="switchTab('MP')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-MP">
                Manajemen Perkantoran
            </button>
            <button onclick="switchTab('BR')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-BR">
                Bisnis Retail
            </button>
            <button onclick="switchTab('BD')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-BD">
                Bisnis Digital
            </button>
            <button onclick="switchTab('DKV')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-DKV">
                Desain Komunikasi Visual
            </button>
            <button onclick="switchTab('TKJ')" 
                    class="tab-button border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-all duration-200"
                    id="tab-TKJ">
                Teknik Komputer dan Jaringan
            </button>
        </nav>
    </div>
</div>

<!-- Statistics Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total CPDB -->
    <div class="bg-white rounded-xl shadow-lg border border-green-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-green-100 mr-4">
                <i class="fas fa-users text-3xl text-green-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">Total CPDB</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalCPDB">-</h3>
            </div>
        </div>
    </div>
    <!-- AK -->
    <div class="bg-white rounded-xl shadow-lg border border-blue-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-blue-100 mr-4">
                <i class="fas fa-calculator text-3xl text-blue-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">AK</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalAK">-</h3>
            </div>
        </div>
    </div>
    <!-- MP -->
    <div class="bg-white rounded-xl shadow-lg border border-purple-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-purple-100 mr-4">
                <i class="fas fa-briefcase text-3xl text-purple-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">MP</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalMP">-</h3>
            </div>
        </div>
    </div>
    <!-- DKV -->
    <div class="bg-white rounded-xl shadow-lg border border-red-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-red-100 mr-4">
                <i class="fas fa-palette text-3xl text-red-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">DKV</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalDKV">-</h3>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- BR -->
    <div class="bg-white rounded-xl shadow-lg border border-blue-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-orange-100 mr-4">
                <i class="fas fa-shopping-cart text-3xl text-orange-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">BR</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalBR">-</h3>
            </div>
        </div>
    </div>
    <!-- MP -->
    <div class="bg-white rounded-xl shadow-lg border border-purple-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-yellow-100 mr-4">
                <i class="fas fa-laptop text-3xl text-yellow-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">BD</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalBD">-</h3>
            </div>
        </div>
    </div>
    <!-- DKV -->
    <div class="bg-white rounded-xl shadow-lg border border-red-100 p-6 hover:shadow-xl transition-all duration-200 transform hover:-translate-y-1">
        <div class="flex items-center">
            <div class="p-4 rounded-full bg-gray-100 mr-4">
                <i class="fas fa-desktop text-3xl text-gray-600"></i>
            </div>
            <div>
                <p class="text-sm font-medium text-gray-600">TKJ</p>
                <h3 class="text-3xl font-bold text-gray-800" id="totalTKJ">-</h3>
            </div>
        </div>
    </div>
</div>

<!-- Search and Export Button -->
<div class="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <!-- Search -->
    <div class="relative flex-1 group">
        <input type="text" 
               id="searchInput" 
               class="w-full pl-12 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all duration-200 group-hover:border-green-300"
               placeholder="Cari berdasarkan nama, NISN, NIK, atau asal SMP...">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none group-hover:text-green-500 transition-colors duration-200">
            <i class="fas fa-search text-gray-400"></i>
        </div>
        <!-- Clear search button -->
        <button id="clearSearch" 
                class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200 hidden">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <!-- Export Button -->
    <button type="button" 
            onclick="exportToExcel()"
            class="inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
        <i class="fas fa-file-excel mr-2"></i>
        Export Excel
    </button>
</div>

<!-- Table -->
<div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden transition-all duration-200 hover:shadow-xl">
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">No</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">No Formulir</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Tanggal</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nama</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Asal SMP</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Jurusan</th>
                    <th scope="col" class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Nomor WhatsApp</th>
                    <th scope="col" class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Status Pelunasan</th>
                    <th scope="col" class="px-6 py-4 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider">Detail</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="cpdbTableBody">
                <!-- Table rows will be dynamically populated -->
            </tbody>
        </table>
    </div>
</div>

<!-- Detail Modal -->
<div id="detailModal" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full flex items-center justify-center bg-black bg-opacity-50">
    <div class="relative w-full max-w-4xl max-h-full">
        <div class="relative bg-white rounded-lg shadow-2xl transform transition-all duration-300">
            <!-- Modal header -->
            <div class="flex items-center justify-between p-5 border-b rounded-t">
                <h3 class="text-xl font-semibold text-gray-900" id="modalTitle">
                    Detail CPDB
                </h3>
                <button type="button" onclick="closeModal('detailModal')" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 inline-flex justify-center items-center transition-colors duration-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <!-- Modal body -->
            <div class="p-6 space-y-6" id="detailContent">
                <!-- Content will be dynamically populated -->
            </div>
            <!-- Modal footer -->
            <div class="flex items-center justify-end p-6 space-x-3 border-t border-gray-200 rounded-b">
                <button type="button" onclick="closeModal('detailModal')" class="text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5 hover:text-gray-900 focus:z-10 transition-all duration-200">
                    Tutup
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let allData = [];
let currentTab = 'all';

// Initialize DataTable
$(document).ready(function() {
    loadCPDBData();
    
    // Enhanced search functionality
    const searchInput = $('#searchInput');
    const clearButton = $('#clearSearch');
    
    searchInput.on('input', function() {
        const hasValue = $(this).val().length > 0;
        clearButton.toggleClass('hidden', !hasValue);
        filterData();
    });
    
    clearButton.on('click', function() {
        searchInput.val('');
        $(this).addClass('hidden');
        filterData();
        searchInput.focus();
    });
    
    // Add loading animation
    searchInput.on('focus', function() {
        $(this).parent().addClass('ring-2 ring-green-200');
    }).on('blur', function() {
        $(this).parent().removeClass('ring-2 ring-green-200');
    });
});

function loadCPDBData() {
    $.get('/api/admin/cpdb-tetap', function(data) {
        console.log('Loaded CPDB data:', data); // Debug log
        allData = data;
        updateStats(data);
        filterData();
    }).fail(function(error) {
        console.error('Error loading CPDB data:', error); // Debug log
        showToast('Gagal memuat data CPDB', 'error');
    });
}

function switchTab(tab) {
    currentTab = tab;
    $('.tab-button').removeClass('border-green-500 text-green-600').addClass('border-transparent text-gray-500');
    $(`#tab-${tab}`).removeClass('border-transparent text-gray-500').addClass('border-green-500 text-green-600');
    filterData();
}

function updateStats(data) {
    console.log('Updating stats with data:', data); // Debug log
    const stats = {
        total: data.length,
        AK: data.filter(cpdb => cpdb.kode === 'AK').length,
        MP: data.filter(cpdb => cpdb.kode === 'MP').length,
        BR: data.filter(cpdb => cpdb.kode === 'BR').length,
        BD: data.filter(cpdb => cpdb.kode === 'BD').length,
        DKV: data.filter(cpdb => cpdb.kode === 'DKV').length,
        TKJ: data.filter(cpdb => cpdb.kode === 'TKJ').length
    };
    
    console.log('Calculated stats:', stats); // Debug log
    
    $('#totalCPDB').text(stats.total);
    $('#totalAK').text(stats.AK);
    $('#totalMP').text(stats.MP);
    $('#totalBR').text(stats.BR);
    $('#totalBD').text(stats.BD);
    $('#totalDKV').text(stats.DKV);
    $('#totalTKJ').text(stats.TKJ);
}

function filterData() {
    try {
        const searchValue = $('#searchInput').val().toLowerCase().trim();
        console.log('Search value:', searchValue);
        console.log('Current tab:', currentTab);
        console.log('Total data before filter:', allData.length);

        // Make a copy of the data
        let filteredData = [...allData];

        // Filter by tab first
        if (currentTab !== 'all') {
            filteredData = filteredData.filter(cpdb => cpdb.kode === currentTab);
        }
        console.log('Data after tab filter:', filteredData.length);

        // Then filter by search if there's a search value
        if (searchValue) {
            filteredData = filteredData.filter(cpdb => {
                // Convert all values to lowercase strings and handle null/undefined
                const nama = String(cpdb.nama_lengkap || '').toLowerCase();
                const nisn = String(cpdb.nisn || '').toLowerCase();
                const nik = String(cpdb.nik || '').toLowerCase();
                const asalSmp = String(cpdb.asal_smp || '').toLowerCase();
                const whatsapp = String(cpdb.nomor_whatsapp || '').toLowerCase();
                const noFormulir = String(cpdb.no_formulir || '').toLowerCase();
                const jurusan = String(cpdb.jurusan || '').toLowerCase();

                // Check if search value exists in any field
                return nama.includes(searchValue) ||
                       nisn.includes(searchValue) ||
                       nik.includes(searchValue) ||
                       asalSmp.includes(searchValue) ||
                       whatsapp.includes(searchValue) ||
                       noFormulir.includes(searchValue) ||
                       jurusan.includes(searchValue);
            });
        }
        
        console.log('Final filtered data count:', filteredData.length);
        renderTable(filteredData);
        
    } catch (error) {
        console.error('Error in filterData:', error);
        showToast('Terjadi kesalahan saat memfilter data', 'error');
    }
}

function renderTable(data) {
    const tbody = $('#cpdbTableBody');
    tbody.fadeOut(150, function() {
        tbody.empty();
        
        if (data.length === 0) {
            tbody.append(`
                <tr>
                    <td colspan="9" class="px-6 py-4 text-center text-gray-500">
                        Tidak ada data yang ditemukan
                    </td>
                </tr>
            `);
        } else {
            data.forEach(function(cpdb, index) {
                const statusClass = cpdb.status_pelunasan === 'LUNAS' 
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-yellow-100 text-yellow-800';
                
                const row = `
                    <tr class="hover:bg-gray-50 transition-all duration-200 transform hover:scale-[1.01]">
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-500">${index + 1}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${cpdb.no_formulir || '-'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(cpdb.tanggal_daftar).toLocaleDateString('id-ID')}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${cpdb.nama_lengkap}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${cpdb.asal_smp}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${cpdb.jurusan}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <a href="https://wa.me/${cpdb.nomor_whatsapp.replace(/^0/, '62')}" 
                               target="_blank"
                               class="inline-flex items-center px-3 py-1 rounded-lg bg-green-50 hover:bg-green-100 transition-colors duration-200">
                                <i class="fab fa-whatsapp text-green-600 mr-2"></i>
                                <span class="text-sm text-green-700">${cpdb.nomor_whatsapp}</span>
                            </a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm">
                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                ${cpdb.status_pelunasan}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                            <button onclick="showDetail('${encodeURIComponent(JSON.stringify(cpdb))}')" 
                                    class="text-green-600 hover:text-green-800 transition-colors duration-200">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>`;
                tbody.append(row);
            });
        }
        tbody.fadeIn(150);
    });
}

function showDetail(cpdbData) {
    const cpdb = JSON.parse(decodeURIComponent(cpdbData));
    const detailContent = $('#detailContent');
    $('#modalTitle').text(`Detail CPDB - ${cpdb.nama_lengkap} - ${cpdb.no_formulir}`);
    
    const content = `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Data Pribadi -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Pribadi</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Tempat Lahir</p>
                        <p class="font-medium">${cpdb.tempat_lahir || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tanggal Lahir</p>
                        <p class="font-medium">${cpdb.tanggal_lahir ? new Date(cpdb.tanggal_lahir).toLocaleDateString('id-ID') : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">No. Registrasi Akta Lahir</p>
                        <p class="font-medium">${cpdb.no_registrasi_akta_lahir || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Agama</p>
                        <p class="font-medium">${cpdb.agama || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Kewarganegaraan</p>
                        <p class="font-medium">${cpdb.kewarganegaraan || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Berkebutuhan Khusus</p>
                        <p class="font-medium">${cpdb.berkebutuhan_khusus || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nomor Telepon</p>
                        <p class="font-medium">${cpdb.nomor_telepon || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Email</p>
                        <p class="font-medium">${cpdb.email || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Mode Transportasi</p>
                        <p class="font-medium">${cpdb.mode_transportasi || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nomor KKS</p>
                        <p class="font-medium">${cpdb.nomor_kks || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Anak Ke-</p>
                        <p class="font-medium">${cpdb.anak_keberapa || '-'}</p>
                    </div>
                </div>
                <div>
                    <p class="text-sm text-gray-500">Alamat</p>
                    <p class="font-medium">${cpdb.alamat_jalan || '-'}</p>
                    <p class="text-sm">RT ${cpdb.rt || '-'} / RW ${cpdb.rw || '-'}</p>
                    <p class="text-sm">${cpdb.nama_dusun || '-'}, ${cpdb.nama_kelurahan || '-'}</p>
                    <p class="text-sm">${cpdb.kecamatan || '-'}, ${cpdb.kode_pos || '-'}</p>
                </div>
            </div>

            <!-- Data Ayah -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Ayah</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Nama Ayah</p>
                        <p class="font-medium">${cpdb.nama_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">NIK Ayah</p>
                        <p class="font-medium">${cpdb.nik_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tempat Lahir</p>
                        <p class="font-medium">${cpdb.tempat_lahir_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tanggal Lahir</p>
                        <p class="font-medium">${cpdb.tanggal_lahir_ayah ? new Date(cpdb.tanggal_lahir_ayah).toLocaleDateString('id-ID') : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nomor Telepon</p>
                        <p class="font-medium">${cpdb.nomor_telepon_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pendidikan</p>
                        <p class="font-medium">${cpdb.pendidikan_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pekerjaan</p>
                        <p class="font-medium">${cpdb.pekerjaan_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Penghasilan</p>
                        <p class="font-medium">${cpdb.penghasilan_perbulan_ayah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Berkebutuhan Khusus</p>
                        <p class="font-medium">${cpdb.berkebutuhan_khusus_ayah || '-'}</p>
                    </div>
                </div>
            </div>

            <!-- Data Ibu -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Ibu</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Nama Ibu</p>
                        <p class="font-medium">${cpdb.nama_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">NIK Ibu</p>
                        <p class="font-medium">${cpdb.nik_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tempat Lahir</p>
                        <p class="font-medium">${cpdb.tempat_lahir_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tanggal Lahir</p>
                        <p class="font-medium">${cpdb.tanggal_lahir_ibu ? new Date(cpdb.tanggal_lahir_ibu).toLocaleDateString('id-ID') : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nomor Telepon</p>
                        <p class="font-medium">${cpdb.nomor_telepon_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pendidikan</p>
                        <p class="font-medium">${cpdb.pendidikan_terakhir_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pekerjaan</p>
                        <p class="font-medium">${cpdb.pekerjaan_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Penghasilan</p>
                        <p class="font-medium">${cpdb.penghasilan_perbulan_ibu || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Berkebutuhan Khusus</p>
                        <p class="font-medium">${cpdb.berkebutuhan_khusus_ibu || '-'}</p>
                    </div>
                </div>
            </div>

            <!-- Data Wali -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Wali</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Nama Wali</p>
                        <p class="font-medium">${cpdb.nama_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">NIK Wali</p>
                        <p class="font-medium">${cpdb.nik_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tempat Lahir</p>
                        <p class="font-medium">${cpdb.tempat_lahir_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tanggal Lahir</p>
                        <p class="font-medium">${cpdb.tanggal_lahir_wali ? new Date(cpdb.tanggal_lahir_wali).toLocaleDateString('id-ID') : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Nomor Telepon</p>
                        <p class="font-medium">${cpdb.nomor_telepon_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pendidikan</p>
                        <p class="font-medium">${cpdb.pendidikan_terakhir_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Pekerjaan</p>
                        <p class="font-medium">${cpdb.pekerjaan_wali || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Penghasilan</p>
                        <p class="font-medium">${cpdb.penghasilan_perbulan_wali || '-'}</p>
                    </div>
                </div>
            </div>

            <!-- Data Periodik -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Periodik</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Tinggi Badan</p>
                        <p class="font-medium">${cpdb.tinggi_badan ? cpdb.tinggi_badan + ' cm' : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Berat Badan</p>
                        <p class="font-medium">${cpdb.berat_badan ? cpdb.berat_badan + ' kg' : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Jarak ke Sekolah</p>
                        <p class="font-medium">${cpdb.jarak_tempuh_ke_sekolah ? cpdb.jarak_tempuh_ke_sekolah + ' km' : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Waktu Tempuh</p>
                        <p class="font-medium">${cpdb.waktu_tempuh_ke_sekolah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Jumlah Saudara Kandung</p>
                        <p class="font-medium">${cpdb.jumlah_saudara_kandung || '-'}</p>
                    </div>
                </div>
            </div>

            <!-- Data Registrasi -->
            <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-900">Data Registrasi</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-sm text-gray-500">Jenis Pendaftaran</p>
                        <p class="font-medium">${cpdb.jenis_pendaftaran || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Tanggal Masuk</p>
                        <p class="font-medium">${cpdb.tanggal_masuk_sekolah ? new Date(cpdb.tanggal_masuk_sekolah).toLocaleDateString('id-ID') : '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Asal Sekolah</p>
                        <p class="font-medium">${cpdb.asal_sekolah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">No. Peserta Ujian</p>
                        <p class="font-medium">${cpdb.nomor_peserta_ujian || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">No. Ijazah</p>
                        <p class="font-medium">${cpdb.no_seri_ijazah || '-'}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">No. SKHUS</p>
                        <p class="font-medium">${cpdb.no_seri_skhus || '-'}</p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    detailContent.html(content);
    openModal('detailModal');
}

function exportToExcel() {
    window.location.href = '/api/admin/cpdb-tetap/export';
}

function openModal(modalId) {
    $(`#${modalId}`).removeClass('hidden').addClass('animate-fade-in');
}

function closeModal(modalId) {
    $(`#${modalId}`).addClass('hidden').removeClass('animate-fade-in');
}

function showToast(message, type = 'success') {
    Toastify({
        text: message,
        duration: 3000,
        gravity: "top",
        position: "right",
        backgroundColor: type === 'success' ? "#16a34a" : "#ef4444",
        className: "rounded-lg shadow-lg",
    }).showToast();
}
</script>
<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }
</style>
